package main

import (
	"fmt"
	"math"
	"strings"
)

const (
	expansion = 1000000
)

type Node struct {
	ID int
	X  int
	Y  int
}

func main() {
	part2(test2)
}

func part2(input string) {
	fieldMap := parseMapForNodes(input)
	fmt.Println(fieldMap)
	nodes := getExpandedNodes(fieldMap)
	printNodes(nodes)
	distance := getNodesDistance(nodes)
	fmt.Println(distance)

}

func getExpandedNodes(fieldMap [][]int) []*Node {
	nodeMap := map[int]*Node{}

	yInc := 0
	for y := 0; y < len(fieldMap); y++ {
		noGalaxies := true
		for x := 0; x < len(fieldMap[0]); x++ {
			if fieldMap[y][x] != 0 {
				noGalaxies = false
				break
			}
		}
		if noGalaxies {
			yInc += expansion - 1
			continue
		}
		for x := 0; x < len(fieldMap[0]); x++ {
			if fieldMap[y][x] != 0 {
				nodeMap[fieldMap[y][x]] = &Node{ID: fieldMap[y][x], X: x, Y: y + yInc}
			}
		}
	}
	xInc := 0
	for x := 0; x < len(fieldMap[0]); x++ {
		noGalaxies := true
		for y := 0; y < len(fieldMap); y++ {
			if fieldMap[y][x] != 0 {
				noGalaxies = false
				break
			}
		}
		if noGalaxies {
			xInc += expansion - 1
			continue
		}

		for y := 0; y < len(fieldMap); y++ {
			if fieldMap[y][x] != 0 {
				node := nodeMap[fieldMap[y][x]]
				node.X += xInc
			}

		}
	}
	nodes := make([]*Node, 0)
	for _, node := range nodeMap {
		nodes = append(nodes, node)
	}
	return nodes
}

func parseMapForNodes(input string) [][]int {
	fieldMap := make([][]int, 0)
	nodeID := 1
	for _, line := range strings.Split(input, "\n") {
		tmp := make([]int, 0)
		for _, c := range strings.Split(line, "") {
			if c == "#" {
				tmp = append(tmp, nodeID)
				nodeID++
				continue
			}
			tmp = append(tmp, 0)

		}
		fieldMap = append(fieldMap, tmp)
	}

	return fieldMap
}

func part1(input string) {
	fieldMap := parseMap(input)
	expandedMap := expandMap(fieldMap)
	printMap(expandedMap)
	nodes := getNodes(expandedMap)
	// printNodes(nodes)
	distance := getNodesDistance(nodes)
	fmt.Println(distance)

}

func getNodesDistance(nodes []*Node) int64 {

	distanceSum := int64(0)
	for i := 0; i < len(nodes); i++ {
		for j := i + 1; j < len(nodes); j++ {
			distanceY := int64(math.Abs(float64(nodes[i].Y) - float64(nodes[j].Y)))
			distanceX := int64(math.Abs(float64(nodes[i].X) - float64(nodes[j].X)))

			distanceSum += distanceX + distanceY
			fmt.Println(nodes[i].ID, nodes[j].ID, distanceX+distanceY)
			fmt.Println(distanceSum)
		}
	}
	return distanceSum

}

func printNodes(nodes []*Node) {
	for _, node := range nodes {
		fmt.Println("ID", node.ID, "X", node.X, "Y", node.Y)
	}
}

func getNodes(fieldMap [][]string) []*Node {
	nodes := make([]*Node, 0)

	nodeID := 0
	for y := 0; y < len(fieldMap); y++ {
		for x := 0; x < len(fieldMap[0]); x++ {
			if fieldMap[y][x] == "#" {
				nodes = append(nodes, &Node{ID: nodeID, X: x, Y: y})
				nodeID++
			}
		}
	}
	return nodes
}

func expandMap(fieldMap [][]string) [][]string {
	expandedMap := make([][]string, len(fieldMap))
	for x := 0; x < len(fieldMap[0]); x++ {
		noGalaxies := true
		for y := 0; y < len(fieldMap); y++ {
			if fieldMap[y][x] == "#" {
				noGalaxies = false
				break
			}
		}

		for y := 0; y < len(fieldMap); y++ {
			expandedMap[y] = append(expandedMap[y], fieldMap[y][x])
			if noGalaxies {
				expandedMap[y] = append(expandedMap[y], fieldMap[y][x])
			}

		}
	}
	finalExpandedMap := make([][]string, 0)
	for y := 0; y < len(expandedMap); y++ {
		noGalaxies := true
		for x := 0; x < len(expandedMap[0]); x++ {
			if expandedMap[y][x] == "#" {
				noGalaxies = false
				break
			}
		}

		finalExpandedMap = append(finalExpandedMap, expandedMap[y])
		if noGalaxies {
			finalExpandedMap = append(finalExpandedMap, expandedMap[y])
		}

	}

	return finalExpandedMap
}

func printMap(fieldMap [][]string) {
	for _, line := range fieldMap {
		for _, c := range line {
			fmt.Printf("%1s", c)
		}
		fmt.Println()
	}
}

func parseMap(input string) [][]string {
	fieldMap := make([][]string, 0)
	for _, line := range strings.Split(input, "\n") {
		tmp := make([]string, 0)
		tmp = append(tmp, strings.Split(line, "")...)
		fieldMap = append(fieldMap, tmp)
	}

	return fieldMap
}

var test1 = `...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#.....`

var test2 = `................................#.......#......#.....#...........................#..........................................................
..........................................................#..........................................................#...........#..........
.....#.....................#.............................................................#..................................................
.............#..............................................................................................................................
.....................................................................................#....................#.................#...............
..................#..........................................#...................................#..............#...........................
...............................#....................................................................................................#.......
..........#..............#.............#................#...................#...............................................................
....#............................................................................#..........................................................
...............#................................#......................................................................#................#...
...................................#.............................#...............................................#..........#.....#.........
#...................................................................................#.....#.....#......#....................................
...............................#............................................................................................................
..........................................................#................#................................................................
.......#.......................................................................................................................#............
..#.........#.........................................................................#.....................................................
..........................................#........#.......................................#.......#..................#............#........
.................#..............#..............................#...............................................#..........................#.
...............................................................................................#........#...................................
......................#............................................#......................................................#.................
.....................................#.....................................#..........................................................#.....
......#......................#...................#......#...................................................................................
..........................................................................................................#.................................
......................................................................#.........................................#.............#.............
#............................................#.........................................#.................................................#..
.............................................................#.....................................#........................................
..............#..............................................................................................#....................#.........
.........#.........#...................................#....................................................................................
........................................#..............................#........................#......#.................#..................
......................................................................................#................................................#....
................#...........#...............................................................................................................
.....................................................#.........#............................................................................
....#.......#.......#.......................................................#.....................#.........................................
.....................................#...........#..............................................................#...........................
..........................................................................................................#.................................
.......................#.............................................#..........#...........................................................
#............................................................#...........................#.................................#.......#........
.............................#......................................................#.................................#.....................
.........................................#............#.................#......................#..............#................#.........#..
............................................................................................................................................
..........#.................................................................................................................................
..........................................................#.......................................#.........................................
#.....................#...............#..........#....................#.................................#...................#...............
............................................................................................................................................
.......#..........................#.........................................................................................................
.................#...............................................#..............................#.................................#.........
........................................................................................................................#...................
..............................#.................#.....#..............................#..........................#...........................
.....................................#.........................................#...........................#.........................#......
.............#.....................................................#............................................................#..........#
....#.........................................................#..................................#..........................................
............................................#...........................#..................................................#................
...............................#.........................................................................#..................................
............................................................................................................................................
.................#.........#....................#..........................#........................................................#.......
.......................................................#....................................#...............................................
............................................................................................................................................
...#...............................................................................#............................................#...........
..........#.....................#......................................................................#....................................
.........................................#..................................................................................................
.....................................................#.................#.............................................#..............#.......
......................#.......................#.............................................................................#...............
........#.............................#..........................#....................#.......................#.............................
.................#..........................................................................#.....#.............................#.........#.
............................................................................................................................................
.........................................................................#..................................................................
..............................................................#.............................................................................
..........................#.............#..........................#.......................................#..........#.....................
............................................................................................................................................
..............................#......................................................................#............#...............#.........
.............#..............................#.........#.................#...................................................................
.....................#............................................................#.......................................#.................
......................................#................................................#.................................................#..
.................#...............................#..........................................................#...............................
........#......................................................#...........#................................................................
.........................................#......................................#...........#.....................#.........................
.#.........................#................................................................................................................
................................................................................................#...................................#......#
...........................................................#............#.............#..................#..................................
..................................................#.........................................................................................
...........#................................#......................#................................................#..........#............
........................#.........#.........................................................................................................
.............................................................#.................................#...............#...........#................
................#............#.......................................................................#......................................
.#......................................................................#......#...........#................................................
........................................................#..................................................#................................
......................#...................#.....#..................#..............................#.........................................
............................................................................................................................................
...........#..........................#....................#............................................................#...................
...................#...................................................................#...............................................#....
...........................#...................................................................#.........#..................................
.....#...........................................#.........................................................................#................
......................#.............#......................................#......#.................#.......................................
...............#..............#...........................................................#.....................#...............#...........
...........................................................#.....#.........................................................................#
.......................................#...............................#....................................................................
.................................#..................#..................................................................................#....
...........................................#..................................#.........................#...................................
.........#..............................................................................#...................................................
................#.....#................................#.................................................................#..................
.................................................................................................#..........................................
#..............................................#........................#...........................................#................#......
..............................#...................................................#.......................#.................................
..................#.................................#......................................................................................#
..........#................................#..................................#...........#.................................................
.....................................................................#....................................................#.................
...............#.....................................................................................................#......................
#........................................................#......#..........................................#........................#.......
.......................#.........#......#...................................................................................................
.....#......................................................................................................................................
..................#...............................#....................................................................#....................
............................................#......................#........................................................................
.............#........................................#.........................#.........#........................#.....................#..
...................................................................................................#..............................#.........
..........................#.................................................................................................................
..#................#....................................................#.......................................#...........................
...........#.................................#.........................................#................................#.............#.....
......................................#.......................#.....#.....................................#.................................
.................................#...............................................................#..........................................
.................#..........#.............................................#.......#...............................#..........#..............
.......................................................#................................................................................#...
..#........................................................................................#................................................
............................................................................................................................................
...................................#..........................................#.............................................................
...........................................#........#...............................................#...........................#...........
................................................................#......#....................................................................
....#.................#.........................#...............................................................#...........................
............................#..............................................................................#................#.......#.......
........#................................#................#.............................#............................#......................
#....................................................#..................................................................................#...
............#........................................................#........................#.............................................
..................#................#.......................................#................................................................
...........................#...............#......#..........#..................#..................#.................................#.....#
..........................................................................................#......................#.........#................
.......................................#....................................................................#...............................
...............#..............#........................................#................................................................#...
..........#.................................................................#...............................................................
.....#...............................................#.....#.....................................#..................#.........#.............
...............................................#........................................................#...................................
.#....................#.............................................................#.................................................#.....`
